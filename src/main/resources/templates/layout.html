<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Usuario</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>

    <body class="bg-light">

        <header>
            <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm py-3">
                <div class="container">
                    <a class="navbar-brand fw-bold d-flex align-items-center" th:href="@{/usuario}">
                        <i class="bi bi-gear-fill me-2 fs-4"></i>
                        Usuarios
                    </a>

                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarMain">
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item">
                                <a class="nav-link fw-semibold" th:href="@{/usuario}">
                                    <i class="bi bi-people-fill me-1"></i>Lista de usuarios
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>

        <main class="container my-5">
            <div class="bg-white p-4 rounded-4 shadow-sm" layout:fragment="contenido"></div>
        </main>

        <footer class="bg-white border-top py-3 shadow-sm mt-5">
            <div class="text-center small text-muted">
                © 2025 Ulises Muñoz Jacobo
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <th:block layout:fragment="js">
        <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
        <script>

        $(document).ready(function () {

            $.ajax({
                url: "http://localhost:8080/api/pais",
                type: "GET",
                dataType: "json",
                success: function (result) {

                    $("#ddlPais").empty();
                    $("#ddlPais").append("<option value='0'>Selecciona un País</option>");

                    $.each(result.object, function (i, pais) {
                        $("#ddlPais").append(
                                `<option value="${pais.idPais}">${pais.nombre}</option>`
                                );
                    });
                },
                error: function () {
                    alert("No se pudieron cargar los países");
                }
            });

        });


        $("#ddlPais").change(function () {
            $.ajax({
                url: "http://localhost:8080/api/estado/pais?IdPais=" + $("#ddlPais").val(),
                type: 'GET',
                dataType: 'JSON',
                success: function (result) {
                    $("#ddlEstado").empty();
                    $("#ddlEstado").append("<option value='0' selected>Selecciona algún Estado</option>");

                    $.each(result.Object, function (i, estado) {
                        $("#ddlEstado").append("<option value='" + estado.idEstado + "'>" + estado.nombre + "</option>");
                    });
                },
                error: function () {
                    alert("No se pudo consultar los estados");
                }
            });
        });

        $("#ddlEstado").change(function () {
            $.ajax({
                url: "http://localhost:8080/api/municipio/estado?IdEstado=" + $("#ddlEstado").val(),
                type: 'GET',
                dataType: 'JSON',
                success: function (result) {
                    $("#ddlMunicipio").empty();
                    $("#ddlMunicipio").append("<option value='0' selected>Selecciona algún municipio</option>");

                    $.each(result.Objects, function (i, municipio) {
                        $("#ddlMunicipio").append("<option value='" + municipio.idMunicipio + "'>" + municipio.nombre + "</option>");
                    });
                },
                error: function () {
                    alert("No se pudo consultar los municipios");
                }
            });
        });

        $("#ddlMunicipio").change(function () {
            $.ajax({
                url: "http://localhost:8080/api/colonia/municipio?IdMunicipio=" + $("#ddlMunicipio").val(),
                type: 'GET',
                dataType: 'JSON',
                success: function (result) {
                    $("#ddlColonia").empty().append("<option value='0' selected>Selecciona alguna colonia</option>");
                    $("#ddlCodigoPostal").empty().append("<option value='0' selected>Seleccione un Código Postal</option>");

                    $.each(result.Objects, function (i, colonia) {
                        $("#ddlColonia").append("<option value='" + colonia.idColonia + "'>" + colonia.nombre + "</option>");
                        $("#ddlCodigoPostal").append("<option value='" + colonia.idColonia + "'>" + colonia.codigoPostal + "</option>");
                    });
                },
                error: function () {
                    alert("No se pudo consultar las colonias");
                }
            });
        });
    </script>
    </th:block>

</body>
</html>
